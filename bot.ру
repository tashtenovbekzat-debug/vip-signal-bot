import os
import telebot
from telebot.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton

# ====== –í–°–¢–ê–í–¨ –°–í–û–ô –¢–û–ö–ï–ù –°–Æ–î–ê ======
BOT_TOKEN = "8492510753:AAGHwAzTlKFHn_XsDtimZ98DJxXwOkb3NoU"

ADMIN_ID = 8394704301
VIP_CHANNEL = -1003735072360

bot = telebot.TeleBot(BOT_TOKEN, parse_mode="HTML")

# ====== –ú–ï–ù–Æ ======
def main_menu():
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(KeyboardButton("üí∞ –¶–µ–Ω–∞ VIP"))
    kb.add(KeyboardButton("‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª"))
    kb.add(KeyboardButton("üÜî –ú–æ–π ID"))
    kb.add(KeyboardButton("üß™ L1 Test Signal"))
    return kb

@bot.message_handler(commands=["start"])
def start(message):
    bot.send_message(
        message.chat.id,
        "üî• <b>ALPHA GOLD VIP</b> üî•\n\n"
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VIP —Å–∏–≥–Ω–∞–ª—ã üìà\n"
        "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ:",
        reply_markup=main_menu()
    )

@bot.message_handler(commands=["ping"])
def ping(message):
    bot.reply_to(message, "pong ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç")

@bot.message_handler(func=lambda m: m.text == "üÜî –ú–æ–π ID")
def myid(message):
    bot.send_message(message.chat.id, f"–¢–≤–æ–π ID: <code>{message.from_user.id}</code>")

@bot.message_handler(func=lambda m: m.text == "üí∞ –¶–µ–Ω–∞ VIP")
def price(message):
    bot.send_message(message.chat.id,
    "üíé VIP –¥–æ—Å—Ç—É–ø:\n\n1 –º–µ—Å—è—Ü ‚Äî 200$\n3 –º–µ—Å—è—Ü–∞ ‚Äî 500$\n\n–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏: ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª")

# ====== –û–ü–õ–ê–¢–ê ======
@bot.message_handler(func=lambda m: m.text == "‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª")
def paid(message):
    user_id = message.from_user.id
    username = message.from_user.username or "-"

    text = (
        "üí∏ <b>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</b>\n\n"
        f"ID: <code>{user_id}</code>\n"
        f"Username: @{username}\n\n"
        f"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å:\n<code>/ok {user_id}</code>"
    )

    bot.send_message(ADMIN_ID, text)
    bot.send_message(message.chat.id, "‚è≥ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—É. –û–∂–∏–¥–∞–π –¥–æ—Å—Ç—É–ø.")

# ====== –í–´–î–ê–ß–ê –î–û–°–¢–£–ü–ê ======
@bot.message_handler(commands=["ok"])
def ok(message):
    if message.from_user.id != ADMIN_ID:
        return

    parts = message.text.split()
    if len(parts) != 2:
        bot.send_message(message.chat.id, "–ü–∏—à–∏: /ok ID")
        return

    user_id = int(parts[1])

    try:
        link = bot.create_chat_invite_link(
            chat_id=VIP_CHANNEL,
            member_limit=1
        )

        bot.send_message(
            user_id,
            "‚úÖ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞\n–í–æ—Ç —Å—Å—ã–ª–∫–∞ –≤ VIP:\n" + link.invite_link
        )

        bot.send_message(message.chat.id, "–ì–æ—Ç–æ–≤–æ ‚úÖ")

    except Exception as e:
        bot.send_message(message.chat.id, f"–û—à–∏–±–∫–∞: {e}")

# ====== TEST SIGNAL ======
pending = {}

def send_signal():
    text = (
        "üëë <b>ALPHA GOLD VIP SIGNAL</b>\n\n"
        "üìä GOLD (XAUUSD)\n"
        "Signal: BUY üü¢\n"
        "TF: M5\n\n"
        "Entry: TEST\nTP1: TEST\nTP2: TEST\nSL: TEST\n\n"
        "Mode: L1 TEST\nConfidence: TEST\n"
    )

    kb = InlineKeyboardMarkup()
    kb.row(
        InlineKeyboardButton("‚úÖ OK –≤ VIP", callback_data="send"),
        InlineKeyboardButton("‚ùå Reject", callback_data="no")
    )

    bot.send_message(ADMIN_ID, text, reply_markup=kb)

@bot.message_handler(func=lambda m: m.text == "üß™ L1 Test Signal")
def test_signal(message):
    if message.from_user.id == ADMIN_ID:
        send_signal()

@bot.callback_query_handler(func=lambda call: True)
def cb(call):
    if call.from_user.id != ADMIN_ID:
        return

    if call.data == "send":
        bot.send_message(VIP_CHANNEL, "üöÄ TEST SIGNAL –í VIP")
        bot.answer_callback_query(call.id, "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ VIP")

    if call.data == "no":
        bot.answer_callback_query(call.id, "–û—Ç–∫–ª–æ–Ω–µ–Ω–æ")

print("BOT STARTED...")
bot.infinity_polling()